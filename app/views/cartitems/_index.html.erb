
  <% if user_signed_in? %>
  <h1>Cartitems</h1>
<div class="container" style="width: auto" >
<table class="table table-hover">
   <thead  class="table-dark"> 

      <th class="col-md-1">Quantity</th>
      <th class="col-md-1">Product</th>
      <th class="col-md-1">Price</th>
      <th class="col-md-3">Image</th>
      <th class="col-md-1"> Sub Total</th>
      <th class="col-md-1">Show</th>
      <th class="col-md-1">Edit</th>
      <th class="col-md-1">Delete</th>
    
  </thead>

  <tbody>
    <% @cartitems.each do |cartitem| %>
      <tr>
      <td><%= cartitem.quantity%></td>
      <td><%= cartitem.product.title%> </td>    
      <td id="price" value=""><%= cartitem.product.price%></td>
    
     <td><%= image_tag cartitem.product.image.url, style:'width:20% ;height:40%' %></td> 

    <td>
    <% cart_total=cartitem.total(cartitem.product,cartitem.quantity,cartitem)%>
    <% cartitem.update(subtotal: cart_total) %>
      <%= cartitem.subtotal%>
    </td>
 

        <td colspan="3"><%= link_to 'Show', cartitem %></td>
        <td colspan="3"><%= link_to 'Edit', edit_cartitem_path(cartitem) %></td>
        <td colspan="3"><%= link_to 'Destroy', cartitem, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
   
        <% end %>
         <tr><label>Grand Total</label>  
      <%= current_user.cart.cartitems.sum(:subtotal) %>
</tr>
     
  </tbody>
</table>

</div>

<a href="/orders/new">Checkout</a>
<br>
<% else %>
<h1> You must sign in</h1>
<% end %>
